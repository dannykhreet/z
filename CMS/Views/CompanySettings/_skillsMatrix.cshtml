@model WebApp.ViewModels.CompanySettingsViewModel

<!-- Right Content Area -->
<div class="col-9 p-4" style="border-radius: 8px; max-width:100%; max-height: calc(100vh - 225px); overflow-y: auto;">
    <!-- Rounding Options Section -->
    <div class="btn-group btn-group-toggle" data-toggle="buttons" style="display: flex; justify-content: space-between;">
        <!-- Use Round Down -->
        <label id="RoundDown_label" class="btn work-instructions-option @(Model.ApplicationSettings?.Features?.EnableMatrixScoreStandard == false ? "active" : "")">
            <input type="radio" name="RoundDown" id="RoundDown" value="RoundDown" @(Model.ApplicationSettings?.Features?.EnableMatrixScoreStandard == false ? "checked" : "") />
            <div class="option-content">
                <i id="RoundDown_icon" class="fa-solid fa-arrow-down-from-line"></i>
                <div class="option-text">
                    <strong>@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.EnableSkillMatrixTitle, "Round down") ?? "Round down") </strong><br>
                    <span>@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.EnableSkillMatrixDescription, "The score from an assessment will always be rounded down.") ?? "The score from an assessment will always be rounded down.")</span>
                </div>
            </div>
        </label>

        <!-- Use Standard Round  -->
        <label id="do_not_RoundDown_label" class="btn work-instructions-option @(Model.ApplicationSettings?.Features?.EnableMatrixScoreStandard == true ? "active" : "")">
            <input type="radio" name="RoundDown" id="donotRoundDown" value="donotRoundDown" @(Model.ApplicationSettings?.Features?.EnableMatrixScoreStandard == true ? "checked" : "") />
            <div class="option-content">
                <i id="RoundDown_icon" class="fa-solid fa-arrows-from-line"></i>
                <div class="option-text">
                    <strong>@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.DisableSkillMatrixTitle, "Standard rounding") ?? "Standard rounding") </strong><br>
                    <span>@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.DisableSkillMatrixDescription, "Scores below .5 round down, scores of .5 or above round up.") ?? "Scores below .5 round down, scores of .5 or above round up.")</span>
                </div>
            </div>
        </label>
    </div>

    <!-- Legend Customization Section -->
    <div class="mt-4 p-4" style="background-color: #f8f9fa; border-radius: 8px;">
        <h5 class="mb-3">
            <i class="fa fa-palette mr-2"></i>
            @(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.CustomizeLegendTitle, "Customize skill color codes and skill level text") ?? "Customize skill color codes and skill level text")
        </h5>

        <!-- Mandatory Skills Section -->
        <div class="mb-4">
            <h6 class="text-muted mb-3">@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.MandatorySkillsTitle, "Mandatory skills") ?? "Mandatory skills")</h6>

            <!-- Masters the skill -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="mandatory" data-skill-level-id="1">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-green legend-preview-btn" type="button" data-icon-class="thumbsup" style="width: 40px; height: 40px; cursor: pointer;"><i class="fa fa-thumbs-up"></i></button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueMastersTheSkill, "Masters the skill") ?? "Masters the skill")" style="flex: 1;" />
            </div>

            <!-- Almost expired -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="mandatory" data-skill-level-id="2">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-orange legend-preview-btn" type="button" data-icon-class="warning" style="width: 40px; height: 40px; cursor: pointer;"><i class="fa fa-exclamation-triangle"></i></button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueAlmostExpired, "Almost expired") ?? "Almost expired")" style="flex: 1;" />
            </div>

            <!-- Expired -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="mandatory" data-skill-level-id="3">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-red legend-preview-btn" type="button" data-icon-class="warning" style="width: 40px; height: 40px; cursor: pointer;"><i class="fa fa-exclamation-triangle"></i></button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueExpired, "Expired") ?? "Expired")" style="flex: 1;" />
            </div>
        </div>

        <!-- Operational Skills Section -->
        <div class="mb-3">
            <h6 class="text-muted mb-3">@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.OperationalSkillsTitle, "Operational skills") ?? "Operational skills")</h6>

            <!-- Score 1 - Doesn't know the theory -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="operational" data-skill-level-id="1" data-score-value="1">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-red legend-preview-btn legend-score-btn" type="button" style="width: 40px; height: 40px; font-size: 18px; cursor: pointer;">1</button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueNoKnowTheTheory, "Doesn't know the theory") ?? "Doesn't know the theory")" style="flex: 1;" />
            </div>

            <!-- Score 2 - Knows the theory -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="operational" data-skill-level-id="2" data-score-value="2">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-orangered legend-preview-btn legend-score-btn" type="button" style="width: 40px; height: 40px; font-size: 18px; cursor: pointer;">2</button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueKnowTheTheory, "Knows the theory") ?? "Knows the theory")" style="flex: 1;" />
            </div>

            <!-- Score 3 - Standard situations -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="operational" data-skill-level-id="3" data-score-value="3">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-orange legend-preview-btn legend-score-btn" type="button" style="width: 40px; height: 40px; font-size: 18px; cursor: pointer;">3</button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueStandardSituations, "Is able to apply this in the standard situations") ?? "Is able to apply this in the standard situations")" style="flex: 1;" />
            </div>

            <!-- Score 4 - Non-standard conditions -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="operational" data-skill-level-id="4" data-score-value="4">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-orangegreen legend-preview-btn legend-score-btn" type="button" style="width: 40px; height: 40px; font-size: 18px; cursor: pointer;">4</button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueNonStandardConditions, "Is able to apply this in the non-standard conditions") ?? "Is able to apply this in the non-standard conditions")" style="flex: 1;" />
            </div>

            <!-- Score 5 - Can educate others -->
            <div class="legend-item-row d-flex align-items-center mb-2" data-skill-type="operational" data-skill-level-id="5" data-score-value="5">
                <div class="legend-icon-preview mr-3" style="position: relative;">
                    <button class="btn circlebtn btn-green legend-preview-btn legend-score-btn" type="button" style="width: 40px; height: 40px; font-size: 18px; cursor: pointer;">5</button>
                    <span class="legend-edit-indicator" style="position: absolute; bottom: -2px; right: -2px; background: #93C54B; border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">
                        <i class="fa fa-pencil" style="font-size: 8px; color: white;"></i>
                    </span>
                </div>
                <input type="text" class="form-control legend-label-input" value="@(Model?.CmsLanguage.GetValue(LanguageKeys.Skills.ValueCanEducateOthers, "Can educate others") ?? "Can educate others")" style="flex: 1;" />
            </div>
        </div>
    </div>
</div>

<!-- Color Picker Modal -->
<div class="modal fade" id="LegendColorPickerModal" tabindex="-1" role="dialog" aria-labelledby="LegendColorPickerModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="LegendColorPickerModalTitle">
                    @(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.CustomizeLegendItemTitle, "Customize skill level text and color codes for") ?? "Customize skill level text and color codes for")
                    <strong id="legendItemTitle"></strong>
                </h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Level Text Input -->
                <div class="form-group mb-4">
                    <label for="legendLevelText">@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.LevelTextLabel, "Level text") ?? "Level text")</label>
                    <input type="text" class="form-control" id="legendLevelText" placeholder="Enter skill level text" />
                </div>

                <div class="row">
                    <!-- Color of the number/icon -->
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="iconColorPicker">@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.ColorOfNumberLabel, "Color of the number/icon") ?? "Color of the number/icon")</label>
                            <div class="d-flex align-items-center">
                                <input id="iconColorPicker" type="color" class="form-control form-control-color" value="#52AC52" style="width: 60px; height: 40px; padding: 2px; cursor: pointer;" />
                                <input type="text" class="form-control form-control-sm ms-2" id="iconColorHex" value="#52AC52" style="width: 100px;" />
                            </div>
                        </div>
                    </div>

                    <!-- Color of the background -->
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="bgColorPicker">@(Model?.CmsLanguage.GetValue(LanguageKeys.Setting.ColorOfBackgroundLabel, "Color of the background") ?? "Color of the background")</label>
                            <div class="d-flex align-items-center">
                                <input id="bgColorPicker" type="color" class="form-control form-control-color" value="#E5F3E5" style="width: 60px; height: 40px; padding: 2px; cursor: pointer;" />
                                <input type="text" class="form-control form-control-sm ms-2" id="bgColorHex" value="#E5F3E5" style="width: 100px;" />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Preview -->
                <div class="mt-4 text-center">
                    <div class="legend-preview-circle" id="colorPreviewCircle" style="width: 60px; height: 60px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; border: 2px solid; margin: 0 auto;">
                        <span id="previewContent">4</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
                    @(Model?.CmsLanguage.GetValue(LanguageKeys.Shared.BtnClose, "Close") ?? "Close")
                </button>
                <button type="button" class="btn btn-ezgo btn-sm" id="btnConfirmLegendColor">
                    @(Model?.CmsLanguage.GetValue(LanguageKeys.Shared.BtnConfirm, "Confirm") ?? "Confirm")
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Debounce timer
        let debounceTimer;
        let currentEditingItem = null;
        let legendConfiguration = null;

        // Load legend configuration on page load
        loadLegendConfiguration();

        // Event handler for label clicks (rounding options)
        $('.btn-group-toggle').off('click', 'label').on('click', 'label', function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Clear previous debounce timer
            clearTimeout(debounceTimer);

            // Set debounce timer to prevent multiple requests
            debounceTimer = setTimeout(() => {
                // Remove active class from all buttons
                $('.btn-group-toggle label').removeClass('active');

                // Add active class to the clicked button
                $(this).addClass('active');

                // Determine the selected state and update the UI accordingly
                let settingValue;

                if ($(this).attr('id') === 'RoundDown_label') {
                    // Enable notifications selected
                    settingValue = false;
                    $('#RoundDown').prop('checked', false);
                    $('#donotRoundDown').prop('checked', true);
                } else if ($(this).attr('id') === 'do_not_RoundDown_label') {
                    settingValue = true;
                    $('#RoundDown').prop('checked', true);
                    $('#donotRoundDown').prop('checked', false);
                }

                updateWorkInstructionChangesStatus(settingValue);
            }, 300); // Debounce delay
        });

        // Initialize Work Instructions state properly
        initializeWorkInstructions();

        function initializeWorkInstructions() {
            // Remove 'active' class from both labels
            $('#RoundDown_label').removeClass('active');
            $('#do_not_RoundDown_label').removeClass('active');

            if ($('#RoundDown').is(':checked')) {
                $('#RoundDown_label').addClass('active');
            } else if ($('#donotRoundDown').is(':checked')) {
                $('#do_not_RoundDown_label').addClass('active');
            }
        }

        function updateWorkInstructionChangesStatus(settingValue) {
            $.ajax({
                url: '/CompanySettings/UpdateSkillMatrixChangeScoreStyle',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(settingValue),
                success: function (response) {
                    toastr.success('@(Model?.CmsLanguage.GetValue(LanguageKeys.CompanySetting.NotifyEndUserSkillMatrixChangeDoneCorrectly, "Skill matrix setting updated correctly") ?? "Skill matrix setting updated correctly")');
                },
                error: function (xhr, status, error) { }
            });
        }

        // Load legend configuration from API
        function loadLegendConfiguration() {
            $.ajax({
                url: '/companysettings/legend',
                type: 'GET',
                success: function (response) {
                    legendConfiguration = response;
                    applyLegendConfiguration(response);
                },
                error: function (xhr, status, error) {
                    console.error('Failed to load legend configuration:', error);
                }
            });
        }

        // Apply legend configuration to UI
        function applyLegendConfiguration(config) {
            if (!config) return;

            // Apply mandatory skills
            if (config.mandatorySkills) {
                config.mandatorySkills.forEach(function (item) {
                    var row = $('.legend-item-row[data-skill-type="mandatory"][data-skill-level-id="' + item.skillLevelId + '"]');
                    if (row.length) {
                        row.find('.legend-label-input').val(item.label);
                        var btn = row.find('.legend-preview-btn');
                        btn.css({
                            'background-color': item.backgroundColor,
                            'border-color': item.iconColor,
                            'color': item.iconColor
                        });
                    }
                });
            }

            // Apply operational skills
            if (config.operationalSkills) {
                config.operationalSkills.forEach(function (item) {
                    var row = $('.legend-item-row[data-skill-type="operational"][data-skill-level-id="' + item.skillLevelId + '"]');
                    if (row.length) {
                        row.find('.legend-label-input').val(item.label);
                        var btn = row.find('.legend-preview-btn');
                        btn.css({
                            'background-color': item.backgroundColor,
                            'border-color': item.iconColor,
                            'color': item.iconColor
                        });
                    }
                });
            }
        }

        // Legend item click handler - open color picker modal
        $('.legend-preview-btn').on('click', function () {
            var row = $(this).closest('.legend-item-row');
            var skillType = row.data('skill-type');
            var skillLevelId = row.data('skill-level-id');
            var scoreValue = row.data('score-value');
            var iconClass = $(this).data('icon-class');
            var currentLabel = row.find('.legend-label-input').val();

            currentEditingItem = {
                row: row,
                skillType: skillType,
                skillLevelId: skillLevelId,
                scoreValue: scoreValue,
                iconClass: iconClass
            };

            // Find current configuration
            var currentItem = null;
            if (legendConfiguration) {
                var skillList = skillType === 'mandatory' ? legendConfiguration.mandatorySkills : legendConfiguration.operationalSkills;
                if (skillList) {
                    currentItem = skillList.find(function (item) { return item.skillLevelId === skillLevelId; });
                }
            }

            // Set modal title
            var titleText = skillType === 'operational' ? 'Score ' + scoreValue + ' operational skills' : currentLabel;
            $('#legendItemTitle').text(titleText);

            // Set current values
            $('#legendLevelText').val(currentLabel);

            if (currentItem) {
                setColorPickerValue('icon', currentItem.iconColor);
                setColorPickerValue('bg', currentItem.backgroundColor);
            }

            // Update preview
            updateColorPreview();

            // Show preview content based on skill type and icon
            if (skillType === 'operational' && scoreValue) {
                $('#previewContent').text(scoreValue);
            } else if (iconClass === 'thumbsup') {
                $('#previewContent').html('<i class="fa fa-thumbs-up"></i>');
            } else if (iconClass === 'warning') {
                $('#previewContent').html('<i class="fa fa-exclamation-triangle"></i>');
            } else {
                $('#previewContent').html('<i class="fa fa-thumbs-up"></i>');
            }

            $('#LegendColorPickerModal').modal('show');
        });

        // Confirm button handler
        $('#btnConfirmLegendColor').on('click', function () {
            if (!currentEditingItem) return;

            var newLabel = $('#legendLevelText').val();
            var newIconColor = $('#iconColorHex').val();
            var newBgColor = $('#bgColorHex').val();

            // Update UI
            var row = currentEditingItem.row;
            row.find('.legend-label-input').val(newLabel);
            var btn = row.find('.legend-preview-btn');
            btn.css({
                'background-color': newBgColor,
                'border-color': newIconColor,
                'color': newIconColor
            });
            // Also update the icon color inside the button
            btn.find('i').css('color', newIconColor);

            // Update configuration
            if (legendConfiguration) {
                var skillList = currentEditingItem.skillType === 'mandatory' ? legendConfiguration.mandatorySkills : legendConfiguration.operationalSkills;
                if (skillList) {
                    var item = skillList.find(function (item) { return item.skillLevelId === currentEditingItem.skillLevelId; });
                    if (item) {
                        item.label = newLabel;
                        item.iconColor = newIconColor;
                        item.backgroundColor = newBgColor;
                    }
                }
            }

            // Save to server
            saveLegendConfiguration();

            $('#LegendColorPickerModal').modal('hide');
        });

        // Save legend configuration
        function saveLegendConfiguration() {
            if (!legendConfiguration) return;

            $.ajax({
                url: '/companysettings/legend',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(legendConfiguration),
                success: function (response) {
                    toastr.success('@(Model?.CmsLanguage.GetValue(LanguageKeys.CompanySetting.LegendUpdatedSuccessfully, "Legend configuration updated successfully") ?? "Legend configuration updated successfully")');
                },
                error: function (xhr, status, error) {
                    console.error('Failed to save legend configuration:', error);
                    toastr.error('@(Model?.CmsLanguage.GetValue(LanguageKeys.CompanySetting.LegendUpdateFailed, "Failed to update legend configuration") ?? "Failed to update legend configuration")');
                }
            });
        }

        // Label input change handler - debounced save
        $('.legend-label-input').on('change', function () {
            var row = $(this).closest('.legend-item-row');
            var skillType = row.data('skill-type');
            var skillLevelId = row.data('skill-level-id');
            var newLabel = $(this).val();

            if (legendConfiguration) {
                var skillList = skillType === 'mandatory' ? legendConfiguration.mandatorySkills : legendConfiguration.operationalSkills;
                if (skillList) {
                    var item = skillList.find(function (item) { return item.skillLevelId === skillLevelId; });
                    if (item) {
                        item.label = newLabel;
                    }
                }
            }

            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function () {
                saveLegendConfiguration();
            }, 500);
        });

        // Native color picker functionality
        function setColorPickerValue(prefix, hexColor) {
            if (!hexColor || hexColor.length < 4) return;
            // Ensure hex color is 7 characters (with #)
            if (hexColor.length === 4) {
                hexColor = '#' + hexColor[1] + hexColor[1] + hexColor[2] + hexColor[2] + hexColor[3] + hexColor[3];
            }
            $('#' + prefix + 'ColorPicker').val(hexColor);
            $('#' + prefix + 'ColorHex').val(hexColor.toUpperCase());
        }

        function updateColorPreview() {
            var iconColor = $('#iconColorHex').val();
            var bgColor = $('#bgColorHex').val();
            $('#colorPreviewCircle').css({
                'background-color': bgColor,
                'border-color': iconColor,
                'color': iconColor
            });
        }

        // Native color picker change event
        $('#iconColorPicker, #bgColorPicker').on('input change', function () {
            var prefix = $(this).attr('id').includes('icon') ? 'icon' : 'bg';
            var hexColor = $(this).val().toUpperCase();
            $('#' + prefix + 'ColorHex').val(hexColor);
            updateColorPreview();
        });

        // Hex input change
        $('#iconColorHex, #bgColorHex').on('input', function () {
            var hex = $(this).val();
            if (hex.length === 7 && hex.charAt(0) === '#') {
                var prefix = $(this).attr('id').includes('icon') ? 'icon' : 'bg';
                $('#' + prefix + 'ColorPicker').val(hex);
                updateColorPreview();
            }
        });
    });
</script>

<style>
    /* Circle button styles */
    .circlebtn {
        width: 48px;
        height: 48px;
        border-radius: 50% !important;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgb(210,210,210);
        font-size: 22px !important;
        outline: 0 !important;
    }

        .circlebtn i {
            font-size: 18px;
        }

    .legend-item-row {
        padding: 8px 12px;
        background-color: white;
        border-radius: 8px;
        margin-bottom: 8px;
        transition: box-shadow 0.2s;
    }

        .legend-item-row:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

    .legend-label-input {
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        padding: 8px 12px;
    }

        .legend-label-input:focus {
            border-color: #93C54B;
            box-shadow: 0 0 0 2px rgba(147, 197, 75, 0.2);
        }

    .legend-preview-btn {
        transition: transform 0.2s;
    }

        .legend-preview-btn:hover {
            transform: scale(1.1);
        }

    /* Native color picker styling */
    .form-control-color {
        border: 2px solid #dee2e6;
        border-radius: 4px;
    }

        .form-control-color:hover {
            border-color: #93C54B;
        }

        .form-control-color:focus {
            border-color: #93C54B;
            box-shadow: 0 0 0 2px rgba(147, 197, 75, 0.2);
        }
</style>