@model WebApp.ViewModels.CompanyViewModel
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "_Layout_template";
}


<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <a asp-controller="Company" asp-action="Index"><i class="fa fa-arrow-left"></i>@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.BackToCompaniesTitle, "Back to companies") ?? "Back to companies")</a>
                <h1>@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.Title, "Company") ?? "Company")</h1>
            </div>
            <div class="col-sm-6 d-flex flex-row-reverse">
                <button class="btn btn-ezgo btn-sm mr-2 shadow-sm mt-auto" onclick="company.save()">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.BtnSave, "Save") ?? "Save")</button>
                @{
                    if (Model != null && Model.Id > 0)
                    {
                            <input data-id="@Model.Id" data-name="@Model.Name" type="button" class="btn btn-danger btn-sm mr-2 shadow-sm mt-auto" id="delete_user_button" onclick="profile.delete()" value="Delete" />

                    }
                }
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>


<section class="content">

    <div class="row pt-1" style="height:calc(100vh - 175px);overflow:auto;">
        <div class="col-lg-12">
            <div class="col-12 p-0 pb-3">
                <div class="row card-group">
                    <div class="col-sm-4 col-md-2">
                        <div class="card h-100" style="width:100%;height:238px;display:flex;border-radius: 5px;">
                            <div class="card-body">
                                <div style="text-align: center;">
                                    <div style="text-align: center; align-content: center;">
                                        <div style="display: inline-flex; position:relative; align-self: center; ">
                                            <img src="/assets/img/normal_unavailable_image.png" id="company_image" class="" style="width: 100%"  />
                                            <div class="controls d-print-none" style="position:absolute;bottom:0px;">
                                                <input class="d-none" type="file" id="uploaderTemplate" accept="image/*" name="photo" onchange="company.previewFile(this);" data-preview="#company_image" data-type="image" required="">
                                                <a href="#" onclick="$('#uploaderTemplate').trigger('click'); return false;">
                                                    <div class="border rounded-circle float-right d-lg-flex justify-content-lg-center shadow main-image-pencil" style="background-color:#FFFFFF;margin-left:4px; margin-bottom:6px; height:20px; width:20px;">
                                                        <i class="fa fa-paperclip d-lg-flex justify-content-center align-items-center align-content-center" style="font-size: 14px;"></i>
                                                    </div>
                                                </a>
                                                <a href="#" data-selector="deletemedia" data-type="template" onclick="company.removeFile(this);" data-preview="#company_image">
                                                    <div class="border rounded-circle float-left d-lg-flex justify-content-lg-center shadow main-image-pencil" style="background-color:#FFFFFF;margin-left:28px; margin-bottom:6px; height:20px; width:20px;">
                                                        <i class="fa fa-trash d-lg-flex justify-content-center align-items-center align-content-center" style="font-size: 14px;"></i>
                                                    </div>
                                                </a>
                                                <video id="dialogVideo" controls="" style="display:none;">
                                                </video>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-8 col-md-10">
                        <div class="card h-100">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_name">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyName, "Name") ?? "Name")</label>
                                        <input type="text" class="form-control" id="company_name" name="company_name" maxlength="200" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_description">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyDescription, "Description") ?? "Description")</label>
                                        <textarea class="form-control" id="company_description" name="company_description"></textarea>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_administrator_firstname">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyAdministratorFirstname, "Administrator first name") ?? "Administrator first name")</label>
                                        <input type="text" class="form-control" id="company_administrator_firstname" name="company_administrator_firstname" maxlength="100" value="EZ" />
                                    </div>
                                    <div class="col">
                                        <label for="company_administrator_lastname">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyAdministratorLastname, "Administrator last name") ?? "Administrator last name")</label>
                                        <input type="text" class="form-control" id="company_administrator_lastname" name="company_administrator_lastname" maxlength="100" value="Factory" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_administrator_username">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyAdministratorUsername, "Administrator user name") ?? "Administrator user name")</label>
                                        <input type="text" class="form-control" id="company_administrator_username" name="company_administrator_username" maxlength="100" value="EZF_@DateTime.Now.ToString("yyMMddhhmmss")" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_administrator_password">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyAdministratorPassword, "Administrator password") ?? "Administrator password")</label>
                                        <input type="text" class="form-control" id="company_administrator_password" name="company_administrator_password" maxlength="100" style="margin-bottom: 4px;" />
                                        <button id="generate_new_password" data-action="generate_password" class="btn btn-info btn-sm mr-2 shadow-sm mt-auto">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.BtnGenerateNewPassword, "Generate password") ?? "Generate password")</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 p-0 pb-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CardCompanyHoldingTitle, "Company Holding") ?? "Company Holding")</h3>
                    </div>
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col pb-2">
                                <label for="company_holding">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyHolding, "Holding") ?? "Holding")</label>
                                <select id="company_holding" class="form-control">
                                    <option value="" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.NoHoldingSelectedTitle, "No holding selected.") ?? "No holding selected.")">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.OptionNoHoldingSelected, "No company holding selected") ?? "No company holding selected")</option>
                                    @if (Model.Holdings != null)
                                    {
                                        @foreach (EZGO.Api.Models.Holding item in Model.Holdings)
                                        {

                                            if (item.Id == Model.HoldingId)
                                            {
                                                <option value="@item.Id" selected title="@item.Name" data-holdingunits="@item.HoldingUnits.ToJsonFromObject()">@item.Name (@item.SecurityGUID)</option>
                                            }
                                            else
                                            {
                                                <option value="@item.Id" title="@item.Name" data-holdingunits="@item.HoldingUnits.ToJsonFromObject()">@item.Name (@item.SecurityGUID)</option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col pb-2">
                                <label for="company_holding_security_guid" title="Enter the security GUID as saved with the selected holding.">Security GUID</label>
                                <input type="text" class="form-control" id="company_holding_security_guid" name="company_holding_security_guid" maxlength="200" value="@Model.HoldingCompanySecurityGUID" title="Enter the security GUID as saved with the selected holding." />
                            </div>
                        </div>
                        <div class="row" data-containertype="holdingunits">
                            <div class="col pb-2">
                                <label for="company_holdingunit">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyHoldingUnitTitle, "Holding unit") ?? "Holding unit")</label>
                                <select id="company_holdingunit" class="form-control" multiple>
                                    <option value="" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.NoHoldingUnitSelectedTitle, "No holding unit selected.") ?? "No holding unit selected.")">@(Model.CmsLanguage.GetValue(LanguageKeys.Company.OptionNoHoldingUnitSelected, "No company holding unit selected or units available") ?? "No company holding unit selected or units available")</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            Depending on functionality, the security code has to be the same as the selected holding security code (displayed between brackets). <br />This is a security measure to make
                            sure that the holding is not accidentally chosen.<br />
                            This currently impacts the following functionality:<br />
                            - Datawarehouse<br />
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 p-0 pb-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanySettingsNameTitle, "Company settings") ?? "Company settings")</h3>
                    </div>

                    <div class="card-body p-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_timezone">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyTimezoneTitle, "Timezone") ?? "Timezone")</label>
                                        <select id="company_timezone" class="form-control" data-resource-id="1">
                                            <option value="" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.NoCompanyTimezoneSelectedTitle, "No company timezone selected, therefor will default to UTC.") ?? "No company timezone selected, therefor will default to UTC.")">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.OptionNoCompanyTimezoneSelected, "No company timezone selected") ?? "No company timezone selected")</option>
                                            @if (Model.Timezones != null)
                                            {
                                                @foreach (EZGO.Api.Models.Settings.DatabaseTimezoneItem item in Model.Timezones)
                                                {
                                                    @if (item.Name == "Europe/Amsterdam")
                                                    {
                                                        <option value="@item.Name" selected title="@item.Name (@item.Abbrivation) - @item.UtcOffset @(item.IsDayLightSavingsTime ? "Daylight Savings Time" : "")">@item.Name (@item.UtcOffset)</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Name" title="@item.Name (@item.Abbrivation) - @item.UtcOffset @(item.IsDayLightSavingsTime ? "Daylight Savings Time" : "")">@item.Name (@item.UtcOffset)</option>
                                                    }

                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_language">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyLanguageTitle, "Language/Locale") ?? "Language/Locale")</label>
                                        <select id="company_language" class="form-control" data-resource-id="99">
                                            <option value="" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.NoCompanyLanguageSelectedTitle, "No company language selected, therefor will default to English.") ?? "No company language selected, therefor will default to English.")">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.OptionNoLanguageOrLocaleSelected, "No language/locale selected") ?? "No language/locale selected")</option>
                                            @if (Statics.AvailableLanguages != null)
                                            {
                                                @foreach (var item in Statics.AvailableLanguages)
                                                {
                                                    var cltr = System.Globalization.CultureInfo.GetCultureInfo(item);
                                                    if (item.ToLower() == "en-us")
                                                    {
                                                        <option value="@item" selected title="@cltr.NativeName">@string.Concat(cltr.NativeName.Substring(0, 1).ToUpper(), cltr.NativeName.Substring(1, cltr.NativeName.Length - 1)) (@cltr.TwoLetterISOLanguageName.ToUpper()) (@cltr.Name) (@cltr.EnglishName)</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item" title="@cltr.NativeName">@string.Concat(cltr.NativeName.Substring(0, 1).ToUpper(), cltr.NativeName.Substring(1, cltr.NativeName.Length - 1)) (@cltr.TwoLetterISOLanguageName.ToUpper()) (@cltr.Name) (@cltr.EnglishName)</option>
                                                    }

                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_country">Country</label>
                                        <select id="company_country" class="form-control" data-resource-id="99">
                                            <option value="" title="No country selected">No country selected.</option>
                                            @if (Model.Countries != null)
                                            {
                                                @foreach (var item in Model.Countries)
                                                {
                                                     <option value="@item.Iso2" title="@item.Name">@item.Name</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_coords">Coordinates (latitude,longitude)</label><br />
                                        <input type="text" class="form-control" id="company_coords" name="company_coords" title="Company coordinates in latitude and longitude." />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_tier">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanyFeatureTierTitle, "Company feature tier") ?? "Company feature tier")</label>
                                        <select id="company_tier" class="form-control" data-resource-id="1">
                                            <option value="essential" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.EssentialTierTitle, "Essential tier") ?? "Essential tier")">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.OptionEssential, "Essential") ?? "Essential")</option>
                                            <option value="advanced" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.AdvancedTierTitle, "Advanced tier") ?? "Advanced tier")">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.OptionAdvanced, "Advanced") ?? "Advanced")</option>
                                            <option value="premium" title="@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.PremiumTierTitle, "Premium tier") ?? "Premium tier")">@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.OptionPremium, "Premium") ?? "Premium")</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_taskgeneration">Task generation enabled</label><br />
                                        <div style="width:40px;"><input type="checkbox" class="form-control" id="company_taskgeneration" name="company_taskgeneration" title="Enable task generation. Note! only enable if functionality is used." /></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_datawarehouse">Data warehouse enabled</label><br />
                                        <div style="width:40px;"><input type="checkbox" class="form-control" id="company_datawarehouse" name="company_datawarehouse" title="Enable data warehouse module." /></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col pb-2">
                                        <label for="company_wichangednotifications">Work instruction changes notifications enabled</label><br />
                                        <div style="width:40px;"><input type="checkbox" class="form-control" id="company_wichangednotifications" name="company_wichangednotifications" title="Enable work instruction changes notifications feature." /></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</section>

@section Scripts{
    <script src="/js/ezgoUtils.js"></script>
    @if (Model.Holdings != null)
    {
        <script>
            var holdingCollection = JSON.parse('@Html.Raw(Model.Holdings.ToJsonFromObject())');
        </script>

    }
    else
    {
        <script>
            var holdingCollection = {};
        </script>
    }
    <script>
        var company = {
            _mediaarray: [],
            _mediapath: '@(string.IsNullOrEmpty(Model.ApplicationSettings?.MediaLocations?.ImageMediaBaseUri) ? Constants.General.MediaUrl : Model.ApplicationSettings?.MediaLocations?.ImageMediaBaseUri)',
            tempImage: null,
            tempImageType: null,
            defaultImage: '/assets/img/normal_unavailable_image.png',
            createCompany: function () {
                let newCompany = {
                    HoldingId: $('#company_holding').val() !== '' ? parseInt($('#company_holding').val()) : null,
                    Description: $('#company_description').val(),
                    Picture: $('#company_image').data('src'),
                    Name: $('#company_name').val(),
                    PrimaryUserName: $('#company_administrator_username').val(),
                    PrimaryUserPassword: $('#company_administrator_password').val(),
                    PrimaryFirstName: $('#company_administrator_firstname').val(),
                    PrimaryLastName: $('#company_administrator_lastname').val(),
                    Locale: $('#company_language').val(),
                    TimeZone: $('#company_timezone').val(),
                    Country: $('#company_country').val(),
                    Coords: $('#company_coords').val(),
                    TierLevel: $('#company_tier').val(),
                    EnableTaskGeneration: $('#company_taskgeneration').is(':checked'),
                    EnableDataWarehouse: $('#company_datawarehouse').is(':checked'),
                    EnableWorkInstructionChangesNotifications: $('#company_wichangednotifications').is(':checked')
                }

                if ($('#company_holding').val() !== '') {
                    newCompany.HoldingId = parseInt($('#company_holding').val());
                    newCompany.HoldingCompanySecurityGUID = $('#company_holding_security_guid').val();
                    if ($('#company_holdingunit').val() != null) {
                        newCompany.HoldingUnitIds = [];
                        let ids = $('#company_holdingunit').val();
                        for (let i = 0; i < ids.length; i++) {
                            newCompany.HoldingUnitIds.push(parseInt(ids[i]));
                        }
                    }

                }

                newCompany.Picture = company.fixImage(newCompany.Picture);

                return newCompany;
            },
            fixImage: function (imageUrl) {
                let imageout = '';
                if (imageUrl != null) {
                    if (imageUrl.includes('unavailable') || imageUrl.startsWith('blob:') || imageUrl.startsWith('/assets/img/')) {
                        return imageout;
                    } else {
                        imageout = imageUrl.replace(company._mediapath, '');
                        return imageout;
                    }
                } else {
                    return imageout;
                }
               
            },
            generatePassword: function () {
                $.ajax({
                    type: "GET",
                    url: '/userpermission/generate/password',
                    success: function (data) {
                        $('#company_administrator_password').val(data);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //console.log('no password auto generated');
                    },
                    contentType: "application/json; charset=utf-8"
                });
            },
            init: function () {
                company.initHandlers();
                company.generatePassword();
            },
            initHandlers: function () {
                $('[data-action="generate_password"]').on('click', function () {
                    company.generatePassword();
                });
                $('#company_holding').on('change', function () {
                    company.setAndSetHoldingUnitSelect($('#company_holding').val());
                });
            },
            previewFile: async function (input) {
                var maxSizeMB = 0.3;

                const options = {
                    maxWidthOrHeight: 480,
                    useWebWorker: true,
                    maxIteration: 1
                };

                var previewElement = $(input).data('preview');
                var compressedFile = event.target.files[0];

                if (compressedFile != undefined && compressedFile !== null) {
                    //First only resize image
                    compressedFile = await imageCompression(compressedFile, options);
                    //console.log(`Successfully compressed file to ${compressedFile.size / 1024} KB.`);
                    //Then compress image if necessary
                    while (compressedFile.size / 1024 / 1024 > maxSizeMB) {
                        options.maxSizeMB = maxSizeMB;
                        compressedFile = await imageCompression(compressedFile, options);
                        //console.log(`Successfully compressed file to ${compressedFile.size / 1024} KB.`);
                    }

                    var ext = compressedFile.name.split('.').pop();
                    var fileReader = new FileReader();
                    fileReader.onload = function () {
                        var url = URL.createObjectURL(compressedFile, { oneTimeOnly: true });
                        company.tempImage = url;
                        company.tempImageType = ext;
                        $(previewElement).data("src", url).parent('a').data('href', url);
                        ezgomediafetcher.preloadImagesAndVideos();
                        ezgomediafetcher.preloadFancyboxAnchors();
                    };
                    fileReader.readAsDataURL(compressedFile);
                }
            },
            removeFile: function (rmbutton) {
                var previewElement = $(rmbutton).attr('data-preview');
                company.tempImage = null;//reset image to null
                company.tempImageType = null; //reset image type to null
                $(previewElement).attr('src', company.defaultImage); //reset to default image
            },
            save: async function () {
                toastr.remove();
                $('body').toggleClass('loaded');

                await company.saveMedia(); //save media if there is media

                let newCompany = company.createCompany();
                //console.log(newCompany);

                $.ajax({
                    type: "POST",
                    url: '/company/create',
                    data: JSON.stringify(newCompany),
                    success: function (data) {
                        $('body').toggleClass('loaded');
                        toastr.success('@(Model?.CmsLanguage.GetValue(LanguageKeys.Company.CompanySaved, "Company Saved") ?? "Company Saved")');
                        setTimeout(() => {
                            location.href = '/company';
                        }, 1000);

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('body').toggleClass('loaded');
                        toastr.error(JSON.parse(jqXHR.responseText) + ' (' + jqXHR.status + ')');
                    },
                    contentType: "application/json; charset=utf-8"
                });
            },
            saveMedia: async function () {
                let output = null;
                if (company.tempImage != null) {
                    if (String(company.tempImage).startsWith('blob:') || String(company.tempImage).startsWith('data:')) {
                        var url = company.tempImage;
                        var ext = '.' + company.tempImageType;
                        company._mediaarray.push({ type: 'company', url: url, ext: ext, delay: 1000, kind: 'pic' });
                    }

                    //array, but only 1 item will be filled.
                    if (company._mediaarray != null && company._mediaarray.length > 0) {
                        //uploading media
                        const tasks = company._mediaarray.map(company.uploadMedia);
                        const results = await Promise.all(tasks);
                        results.forEach(x => output = x);
                        company._mediaarray = []; //reset media array;
                    }
                }
                return output;
            },
            setAndSetHoldingUnitSelect: function (selectedId) {
                if (holdingCollection != null && typeof selectedId !== 'undefined' && selectedId != null) {
                    for (let i = 0; i < holdingCollection.length; i++) {
                        if (holdingCollection[i].Id.toString() === selectedId.toString()) {
                            var foundItem = holdingCollection[i];
                            if (typeof foundItem.HoldingUnits !== 'undefined' && foundItem.HoldingUnits != null) {
                                company.setHoldingUnitSelectOptions(foundItem.HoldingUnits);
                            }
                        }
                    }
                }
            },
            setHoldingUnitSelectOptions: function (holdingUnits, possibleParentName) {
                if (typeof possibleParentName === 'undefined' || possibleParentName == null) { $('#company_holdingunit option').remove(); };
                if (typeof holdingUnits !== 'undefined' && holdingUnits != null) {
                    for (let ii = 0; ii < holdingUnits.length; ii++) {
                        let holdingUnit = holdingUnits[ii];
                        $('#company_holdingunit').append($('<option>', {
                            value: holdingUnit.Id,
                            text: typeof possibleParentName !== 'undefined' ? possibleParentName + ' -> ' + holdingUnit.Name : holdingUnit.Name
                        }));
                        if (typeof holdingUnit.HoldingUnits !== 'undefined' && holdingUnit.HoldingUnits != null) {
                            company.setHoldingUnitSelectOptions(holdingUnit.HoldingUnits, possibleParentName == null ? holdingUnit.Name : possibleParentName + ' -> ' + holdingUnit.Name);
                        }
                    }
                }
            },
            uploadMedia: async function (spec) {

                let blob = await fetch(spec.url).then(
                    r => r.blob()
                );
                var file = new File([blob], $.utils.createUUID() + spec.ext);
                var formData = new FormData();
                formData.append("file", file);
                formData.append("filekind", spec.kind);
                formData.append("itemtype", spec.type);

                return fetch('/company/details/upload', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => (response.text()))
                    .then(path => {
                        var returnedPath = String(path).replaceAll('"', '');
                        $('#company_image').data('src', company._mediapath + returnedPath);
                        $('#Picture').val(returnedPath);
                        ezgomediafetcher.preloadImagesAndVideos();
                    })
                    .then(text => `Fetched ${spec.url}, and got back ${text}`);
            },
            validate: function () {
                $.ajax({
                    type: "POST",
                    url: '/company/validate',
                    data: JSON.stringify(newCompany),
                    success: function (data) {
                        //console.log('succes');
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        toastr.error(jqXHR.responseText + ' (' + jqXHR.status + ')');
                    },
                    contentType: "application/json; charset=utf-8"
                });
            }
        }

        company.init();
        ezgomediafetcher.preloadImagesAndVideos();
    </script>

}

