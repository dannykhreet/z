@model WebApp.ViewModels.WorkInstructionsViewModel
@{
    Layout = "_Layout_template";
    ViewData["Title"] = Model?.CmsLanguage?.GetValue(LanguageKeys.WorkInsctruction.WorkInsctructionTitle, "Work Instructions") ?? "Work Instructions";
}

@section CSS{

    <style>
        #contentBody .card {
            @*box-shadow:none;*@
            border: solid 1px transparent;
            transition: transform .2s; /* Animation */
        }

            #contentBody .card:hover {
                border: solid 1px #93c54b;
                box-shadow: 0 .425rem .75rem rgba(0,0,0,.075) !important;
                color: #93c54b !important;
            }

        #contentBody .card a:active, #contentBody .card a:link, #contentBody .card a:visited {
            @*background-color: aquamarine;*@
        }
        #contentBody .card a:hover {
            color: #93c54b !important;
        }
    #contentBody img.img-fluid {
        border-radius: 5px;
        border: solid 1px #bfbfbf;
    }

    </style>

}

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-0">
            <div class="col-sm-3">
                &nbsp;
                <h1>@(Model?.CmsLanguage?.GetValue(LanguageKeys.WorkInsctruction.OverViewTitle, "Instruction overview") ?? "Instruction overview")</h1>
            </div>
            <div class="col-sm-9 d-flex flex-row-reverse">
                <a asp-controller="workinstructions" asp-action="add" class="btn btn-ezgo btn-sm mr-2 shadow-sm mt-auto">@(Model?.CmsLanguage?.GetValue(LanguageKeys.WorkInsctruction.OverviewListTitle, "Add new instruction") ?? "Add new instruction")</a>
                @if (Model?.ApplicationSettings?.Features != null && Model.ApplicationSettings.Features.ExportAdvancedEnabled != null && Model.ApplicationSettings.Features.ExportAdvancedEnabled.Value && Model.ApplicationSettings.Features.ChecklistsEnabled != null && Model.ApplicationSettings.Features.ChecklistsEnabled.Value)
                {
                    <button class="btn btn-secondary btn-sm btn-outline mr-2 shadow-sm mt-auto" data-export="workinstructiontemplates" title="@(Model?.CmsLanguage?.GetValue(LanguageKeys.WorkInsctruction.ExportTemplates, "Export workinstruction templates") ?? "Export workinstruction templates")"><i class="fa fa-file-excel"></i></button>
                }
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>

<section class="content">

    <div class="container-fluid">

        <div class="row pt-1" style="height:calc(100vh - 167px);overflow:auto;">

            <div class="col-xl-3 d-none d-xl-inline-block">
                <div class="card card-filter">
                    <div class="card-header pb-0">
                        <h3 class="card-title d-none">@(Model?.CmsLanguage?.GetValue(LanguageKeys.Filters.CardTitle, "Filters") ?? "Filters")</h3>
                        <div class="card-tools">
                            <div class="input-group input-group-sm">
                                <div class="input-group-append">
                                    <button type="button" class="btn" onclick="areaFilter.reset('block')" title="@(Model?.CmsLanguage?.GetValue(LanguageKeys.Filters.ResetHover, "Reset filters") ?? "Reset filters")" data-action="resetfilters"><i class="fas fa-undo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body card-filter pt-0">
                        <partial name="_filters_block" model="Model.Filter" />
                    </div>
                </div>
            </div>

            <div class="col-lg-12 col-xl-9">
                <div class="card template-searchbar">
                    <div class="card-header d-flex">
                        <h3 id="cardHeader" class="card-title d-none d-sm-inline-block" style="width:100%">@(Model?.CmsLanguage?.GetValue(LanguageKeys.WorkInsctruction.AssessmentInstructionsTitle, "Assessment instructions") ?? "Assessment instructions")<span id="counter"></span></h3>
                        <div class="card-tools">
                            <div class="input-group input-group-sm">

                                <input type="text" id="workinstructionSearchBox" name="workinstructionSearchBox" class="form-control float-right" placeholder="@(Model?.CmsLanguage?.GetValue(LanguageKeys.WorkInsctruction.Search, "Search") ?? "Search")" data-boxtype="search">

                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                                    <button type="button" class="btn btn-default d-block d-xl-none" data-bs-toggle="collapse" data-bs-target="#collapseExample"><i class="fas fa-filter"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-header collapse" id="collapseExample">
                        <partial name="_filters_inline" model="Model.Filter" />
                    </div>

                </div>
                <div id="contentBody" class="pl-2 pr-3" style="height: calc(100vh - 252px);overflow:auto;">
                    <partial name="_overview" model="@Model" />
                </div>

            </div>

        </div>
    </div>

</section>

<a id="back-to-top" href="#" class="btn btn-ezgo btn-lg back-to-top shadow" role="button"><i class="fas fa-chevron-up"></i></a>

@section Scripts{

    <script src="/js/areafilter.js"></script>
    @if (Model.ApplicationSettings.Features.ExportAdvancedEnabled.HasValue || Model.ApplicationSettings.Features.ExportEnabled.HasValue)
    {
        if (Model.ApplicationSettings.Features.ExportAdvancedEnabled.Value || Model.ApplicationSettings.Features.ExportEnabled.Value)
        {
            <script src="/js/export.js?@(DateTime.Now.ToString("ddMMyyyyHHmmss"))"></script>
            <partial name="~/Views/Shared/_export_language_settings.cshtml" model="@Model" />
        }
    }
    <script>
        areaFilter.init('/config/getareatree', 'checklist');

        $(document).ready(function () {
            var cntr = $('#contentCol .card:visible').length;
            $('#counter').html('&nbsp;(' + cntr + ')');
            $('#back-to-top').fadeOut();
            $('#contentBody').scroll(function () {
                if ($('#contentBody').scrollTop() > 50) {
                    $('#back-to-top').fadeIn();
                } else {
                    $('#back-to-top').fadeOut();
                }
            });

            $('#back-to-top').click(function () {
                $('#contentBody').animate({
                    scrollTop: 0
                }, 400);
                return false;
            });

            $('#btn-close').on('click', function (e) {
                $('.actionRow').css('backgroundColor', '');
                $('.panel-wrap').css('transform', 'translateX(100%)');
            });

            $("#workinstructionSearchBox").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#contentCol div.results").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
                var cntr = $('#contentCol .card:visible').length;
                $('#counter').html('&nbsp;(' + cntr + ')');
                $('#back-to-top').click();
            });

            $("#workinstructionSearchBox").on('search', function () {
                var value = '';

                $("#contentCol div.row.results:visible").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
                var cntr = $('#contentCol .card:visible').length;
                $('#counter').html('&nbsp;(' + cntr + ')');
                $('#back-to-top').click();
            });

            $("#contentCol").on('filterDone', function () {
                //console.log('filterDone');    
                var cntr = $('#contentCol .card:visible').length;
                $('#counter').html('&nbsp;(' + cntr + ')');
                $('.bootstrap-select button .filter-option').addClass('d-flex');
            });

        });
    </script>


}