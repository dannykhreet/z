<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="EZGO.Maui.Views.Shared.ItemsDetailPage"
    xmlns:shared="clr-namespace:EZGO.Maui.Core.ViewModels.Shared;assembly=EZGO.Maui.Core"
    xmlns:customButtons="clr-namespace:EZGO.Maui.Controls.Buttons"
    xmlns:pdfviewer="clr-namespace:EZGO.Maui.Views"
    x:Name="Page"
    xmlns:controls="clr-namespace:EZGO.Maui.Controls"
    x:DataType="shared:ItemsDetailViewModel"
    NavigationPage.HasNavigationBar="False"
    NavigationPage.HasBackButton="False">
    <Grid StyleClass="bg-darkgrey">
        <Grid
            RowSpacing="0"
            InputTransparent="True"
            CascadeInputTransparent="False">
            <Grid.RowDefinitions>
                <RowDefinition Height="{OnPlatform iOS=100, Android=70}" />
                <RowDefinition Height="*" />
                <RowDefinition Height="200" />
            </Grid.RowDefinitions>

            <!--  Picture  -->
            <controls:PinchToZoomContainer
                Grid.Row="0"
                Grid.RowSpan="3"
                IsVisible="{Binding SelectedItem.HasVideo, Converter={StaticResource ReverseBooleanConverter}}">
                <controls:PinchToZoomContainer.Content>
                    <Grid>
                        <controls:CustomImageOnline
                            IsVisible="{Binding IsLocalPicture, Converter={StaticResource ReverseBooleanConverter}}"
                            IsLocalFile="False"
                            ImageUrl="{Binding SelectedItem.Picture}"
                            Aspect="AspectFit"
                            DownsampleToViewSize="False" />
                        <controls:CustomImage
                            IsVisible="{Binding IsLocalPicture}"
                            IsLocalFile="True"
                            ImageUrl="{Binding SelectedItem.Picture}"
                            Aspect="AspectFit"
                            DownsampleToViewSize="False" />
                    </Grid>
                </controls:PinchToZoomContainer.Content>
                <controls:PinchToZoomContainer.GestureRecognizers>
                    <SwipeGestureRecognizer
                        Direction="Left"
                        Command="{Binding SwipedLeft}"
                        CommandParameter="Left" />
                    <SwipeGestureRecognizer
                        Direction="Right"
                        Command="{Binding SwipedRight}"
                        CommandParameter="Right" />
                </controls:PinchToZoomContainer.GestureRecognizers>
            </controls:PinchToZoomContainer>

            <!--  Or a video  -->
            <controls:CustomVideoView
                Grid.Row="0"
                Grid.RowSpan="3"
                IsVisible="{Binding SelectedItem.HasVideo}"
                SelectedItem="{Binding SelectedItem}">
                <controls:CustomVideoView.GestureRecognizers>
                    <SwipeGestureRecognizer
                        Direction="Left"
                        Command="{Binding SwipedLeft}"
                        CommandParameter="Left" />
                    <SwipeGestureRecognizer
                        Direction="Right"
                        Command="{Binding SwipedRight}"
                        CommandParameter="Right" />
                </controls:CustomVideoView.GestureRecognizers>
            </controls:CustomVideoView>

            <!--  Or PDF  -->
            <pdfviewer:PdfViewerControl
                Grid.Row="0"
                Grid.RowSpan="3"
                IsVisible="{Binding SelectedItem.IsPdf}"
                PdfFileStream="{Binding SelectedItem.PDFStream}"
                SwipeLeftCommand="{Binding SwipedLeft}"
                SwipeRightCommand="{Binding SwipedRight}">
                <pdfviewer:PdfViewerControl.GestureRecognizers>
                    <SwipeGestureRecognizer
                        Direction="Left"
                        Command="{Binding SwipedLeft}"
                        CommandParameter="Left" />
                    <SwipeGestureRecognizer
                        Direction="Right"
                        Command="{Binding SwipedRight}"
                        CommandParameter="Right" />
                </pdfviewer:PdfViewerControl.GestureRecognizers>
            </pdfviewer:PdfViewerControl>


            <!--  This swipe gesture is necessary for android video swiping  -->
            <Grid
                Grid.Row="0"
                Grid.RowSpan="2"
                IsVisible="{Binding IsSwipeGestureVisible}">
                <Grid.GestureRecognizers>
                    <SwipeGestureRecognizer
                        Direction="Left"
                        Command="{Binding SwipedLeft}"
                        CommandParameter="Left" />
                    <SwipeGestureRecognizer
                        Direction="Right"
                        Command="{Binding SwipedRight}"
                        CommandParameter="Right" />
                </Grid.GestureRecognizers>
            </Grid>

            <!--  Back button  -->
            <StackLayout Grid.Row="0" VerticalOptions="End">
                <Frame
                    Padding="3,5,7,5"
                    BackgroundColor="{StaticResource GreyColor}"
                    WidthRequest="40"
                    CornerRadius="10"
                    HasShadow="False"
                    BorderColor="{StaticResource GreyColor}"
                    HorizontalOptions="Start"
                    VerticalOptions="CenterAndExpand">

                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding CancelCommand}" />
                    </Frame.GestureRecognizers>

                    <!--  Back arrow  -->
                    <customButtons:BackButton Command="{Binding CancelCommand}" />
                    <Frame.Margin>
                        <OnPlatform x:TypeArguments="Thickness">
                            <On Platform="iOS">20,0,0,0</On>
                            <On Platform="Android,Windows">20,40,0,0</On>
                        </OnPlatform>
                    </Frame.Margin>
                </Frame>

            </StackLayout>

            <!--  Description  -->
            <Grid
                Grid.Row="2"
                IsVisible="{Binding SelectedItem.HasVideo, Converter={StaticResource ReverseBooleanConverter}}"
                BackgroundColor="Transparent">
                <StackLayout
                    Padding="20,15"
                    IsVisible="{Binding SelectedItem.Name, Converter={StaticResource StringIsNullOrEmptyConverter}, ConverterParameter=False}"
                    VerticalOptions="EndAndExpand"
                    BackgroundColor="{StaticResource TransparentBlackColor}">
                    <ScrollView>
                        <StackLayout VerticalOptions="CenterAndExpand" BackgroundColor="Transparent">
                            <Label
                                Text="{Binding SelectedItem.Name}"
                                VerticalOptions="CenterAndExpand"
                                StyleClass="fs-large, fc-white, mx-20"
                                FontFamily="{StaticResource RobotoBold}" />
                            <Label
                                Text="{Binding SelectedItem.Description}"
                                VerticalOptions="CenterAndExpand"
                                StyleClass="fs-small, fc-white, mx-20"
                                FontFamily="{StaticResource RobotoRegular}" />
                            <StackLayout
                                Orientation="Horizontal"
                                StyleClass="mx-20, mt-20"
                                BackgroundColor="Transparent">
                                <Label
                                    FontFamily="{StaticResource RobotoLight}"
                                    Text="{Binding SelectedItem.DueDateString}"
                                    StyleClass="fc-white, fs-small" />
                                <Label
                                    FontFamily="{StaticResource RobotoLight}"
                                    Text="{Binding SelectedItem.OverDueString}"
                                    StyleClass="fc-white, fs-small" />

                            </StackLayout>
                            <Label
                                Padding="20,0,0,0"
                                FontFamily="{StaticResource RobotoLight}"
                                Text="{Binding SelectedItem.TaskMarkedString}"
                                StyleClass="fc-white, fs-small"
                                IsVisible="{Binding SelectedItem.IsTaskMarked}" />
                            <Label
                                Padding="20,0,0,0"
                                FontFamily="{StaticResource RobotoLight}"
                                Text="{Binding CommentString}"
                                StyleClass="fc-white, fs-small"
                                IsVisible="{Binding HasComment}"
                                VerticalOptions="CenterAndExpand" />
                        </StackLayout>
                    </ScrollView>
                </StackLayout>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>
