<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EZGO.Maui.Views.Step.StepsPage"
             Title="StepsPage"
             x:Name="Page"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             xmlns:controls="clr-namespace:EZGO.Maui.Controls"
             xmlns:customButtons="clr-namespace:EZGO.Maui.Controls.Buttons"
             xmlns:panCardView="clr-namespace:PanCardView;assembly=PanCardView"
             xmlns:processors="clr-namespace:PanCardView.Processors;assembly=PanCardView"
             xmlns:ctrls="clr-namespace:PanCardView.Controls;assembly=PanCardView"
             xmlns:settings="clr-namespace:EZGO.Maui.Core.Classes;assembly=EZGO.Maui.Core"
             xmlns:classes="clr-namespace:EZGO.Maui.Classes"
             NavigationPage.HasNavigationBar="false" NavigationPage.HasBackButton="True">
    <ContentPage.Resources>

        <ResourceDictionary>
            <Style x:Key="ActiveIndicator" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource GreenColor}" />
            </Style>
            <Style x:Key="InactiveIndicator" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="White" />
            </Style>
        </ResourceDictionary>

    </ContentPage.Resources>

        <Grid StyleClass="bg-lightgrey" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">
            <Grid.RowDefinitions>
                <RowDefinition Height="80" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" StyleClass="header, bg-white, m-0, pr-15" RowSpacing="0" ColumnSpacing="0">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="145"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="145"/>
                </Grid.ColumnDefinitions>

                <!-- Back button -->
                <customButtons:BackButton
                    Command="{Binding CancelCommand}"
                    Grid.Column="0"
                    VerticalOptions="CenterAndExpand"/>

                <StackLayout Grid.Column="1" StyleClass="column1">
                    <Label Text="{Binding Name}" StyleClass="title, fs-large, fc-darkgrey" HorizontalOptions="StartAndExpand" VerticalOptions="CenterAndExpand" FontFamily="{StaticResource RobotoLight}" MaxLines="2"/>
                </StackLayout>

                <StackLayout Grid.Column="2" StyleClass="column1">
                    <Label Text="{Binding Title}" StyleClass="fs-medium, fc-darkgrey" HorizontalOptions="StartAndExpand" VerticalOptions="CenterAndExpand" FontFamily="{StaticResource RobotoLight}"/>
                </StackLayout>
            </Grid>

            <!-- Detail Page -->
            <StackLayout Grid.Row="1" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">

                <panCardView:CoverFlowView
                        IsRightToLeftFlowDirectionEnabled="{Binding Source={x:Static settings:Settings.IsRightToLeftLanguage}}"
                    ItemsSource="{Binding TaskTuples}"
                    PositionShiftValue="1"
                    IsCyclical="False" 
                    SelectedItem="{Binding SelectedTuple}"
                    SelectedIndex="{Binding CurrentIndex}"   
                    Margin="0,15,0,0"
                    x:Name="CarouselView">

                    <x:Arguments>
                        <processors:CoverFlowProcessor OpacityFactor="1" ScaleFactor="1" />
                    </x:Arguments>

                    <ctrls:IndicatorsControl
                        HorizontalOptions="CenterAndExpand"
                        VerticalOptions="End"
                        SelectedIndicatorStyle="{StaticResource ActiveIndicator}"
                        UnselectedIndicatorStyle="{StaticResource InactiveIndicator}"/>

                    <panCardView:CoverFlowView.ItemTemplate>
                        <DataTemplate>
                            <Grid
                                HorizontalOptions="CenterAndExpand"
                                VerticalOptions="CenterAndExpand"
                                WidthRequest="1000"
                                HeightRequest="600"
                                ColumnSpacing="15"
                                Padding="0,0,0,70">

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Step 1 -->
                                <Grid Grid.Row="0">
                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding BindingContext.DetailCommand, Source={x:Reference Page}}" CommandParameter="{Binding Item1}"/>
                                    </Grid.GestureRecognizers>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="70*"/>
                                        <RowDefinition Height="30*"/>
                                    </Grid.RowDefinitions>

                                    <controls:CustomImageOnline ImageUrl="{Binding Item1.PreviewPicture}" Aspect="AspectFill" Grid.RowSpan="2" />

                                    <!-- Play button -->
                                    <Button Text="{x:Static classes:IconFont.PlayCircleOutline}"
                                            TextColor="White" 
                                            FontSize="64" 
                                            BackgroundColor="Transparent"
                                            FontFamily="{StaticResource MaterialFontFamily}" 
                                            HorizontalOptions="Center" 
                                            VerticalOptions="Center" 
                                            IsVisible="{Binding Item1.IsVideo}"
                                            Command="{Binding BindingContext.DetailCommand, Source={x:Reference Page}}" 
                                            CommandParameter="{Binding Item1}"/>
                                    <Grid Grid.Row="1">

                                        <StackLayout VerticalOptions="Fill" BackgroundColor="{StaticResource TransparentBlackColor}" Padding="20,15">

                                            <ScrollView>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="50"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Label Grid.Column="0" FontFamily="{StaticResource RobotoRegular}" Text="{Binding Item1.Index}" StyleClass="fc-white, fs-32"/>
                                                    <Label Grid.Column="1" FontFamily="{StaticResource RobotoLight}" Text="{Binding Item1.Description}" StyleClass="fc-white, fs-medium, pt-10" LineBreakMode="WordWrap"/>

                                                </Grid>
                                            </ScrollView>

                                        </StackLayout>

                                    </Grid>

                                </Grid>

                                <!-- Step 2 -->
                                <Grid Grid.Column="1" IsVisible="{Binding Item2, Converter={StaticResource IsNullConverter}, ConverterParameter=False}">
                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding BindingContext.DetailCommand, Source={x:Reference Page}}" CommandParameter="{Binding Item2}"/>
                                    </Grid.GestureRecognizers>

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="70*"/>
                                        <RowDefinition Height="30*"/>
                                    </Grid.RowDefinitions>

                                    <controls:CustomImageOnline ImageUrl="{Binding Item2.PreviewPicture}" Aspect="AspectFill" Grid.RowSpan="2" />

                                    <!-- Play button -->
                                    <Button Text="{x:Static classes:IconFont.PlayCircleOutline}"
                                            TextColor="White" 
                                            FontSize="64" 
                                            BackgroundColor="Transparent"
                                            FontFamily="{StaticResource MaterialFontFamily}" 
                                            HorizontalOptions="Center" 
                                            VerticalOptions="Center" 
                                            IsVisible="{Binding Item2.IsVideo}"
                                            Command="{Binding BindingContext.DetailCommand, Source={x:Reference Page}}" 
                                            CommandParameter="{Binding Item2}"/>

                                    <Grid Grid.Row="1">

                                        <StackLayout VerticalOptions="Fill" BackgroundColor="{StaticResource TransparentBlackColor}" Padding="20,15">

                                            <ScrollView>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="50"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Label Grid.Column="0" FontFamily="{StaticResource RobotoRegular}" Text="{Binding Item2.Index}" StyleClass="fc-white, fs-32"/>
                                                    <Label Grid.Column="1" FontFamily="{StaticResource RobotoLight}" Text="{Binding Item2.Description}" StyleClass="fc-white, fs-medium, pt-10" LineBreakMode="WordWrap"/>

                                                </Grid>

                                            </ScrollView>

                                        </StackLayout>

                                    </Grid>

                                </Grid>

                            </Grid>

                        </DataTemplate>
                    </panCardView:CoverFlowView.ItemTemplate>

                </panCardView:CoverFlowView>

            </StackLayout>
        </Grid>
</ContentPage>
