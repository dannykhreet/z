<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage
    x:Class="EZGO.Maui.Views.Assessments.AssessmentsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:actionsModels="clr-namespace:EZGO.Maui.Core.Models.Actions;assembly=EZGO.Maui.Core"
    xmlns:behaviors="clr-namespace:EZGO.Maui.Behaviors"
    xmlns:button="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:buttons="http://schemas.syncfusion.com/maui"
    xmlns:classes="clr-namespace:EZGO.Maui.Classes"
    xmlns:controls="clr-namespace:EZGO.Maui.Controls"
    xmlns:customButtons="clr-namespace:EZGO.Maui.Controls.Buttons"
    xmlns:data="clr-namespace:Syncfusion.Maui.DataSource;assembly=Syncfusion.Maui.DataSource"
    xmlns:inputLayout="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
    xmlns:inputs="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
    xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
    xmlns:list="clr-namespace:EZGO.Maui.Controls.Lists"
    xmlns:listview="clr-namespace:Syncfusion.Maui.ListView;assembly=Syncfusion.Maui.ListView"
    xmlns:models="clr-namespace:EZGO.Maui.Core.Models.Assessments;assembly=EZGO.Maui.Core"
    xmlns:partial="clr-namespace:EZGO.Maui.Views.Partial"
    xmlns:popup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
    xmlns:pulltorefresh="clr-namespace:Syncfusion.Maui.PullToRefresh;assembly=Syncfusion.Maui.PullToRefresh"
    xmlns:sf="clr-namespace:Syncfusion.Maui.ListView;assembly=Syncfusion.Maui.ListView"
    xmlns:utils="clr-namespace:EZGO.Maui.Core.Utils;assembly=EZGO.Maui.Core"
    xmlns:viewCells="clr-namespace:EZGO.Maui.Controls.ViewCells.Templates"
    xmlns:viewModels="clr-namespace:EZGO.Maui.Core.ViewModels.Assessments;assembly=EZGO.Maui.Core"
    x:Name="Page"
    ios:Page.UseSafeArea="true"
    x:DataType="viewModels:AssessmentsViewModel"
    NavigationPage.HasBackButton="False"
    NavigationPage.HasNavigationBar="False">
    <ContentPage.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="LinearItemTemplate" x:DataType="models:AssessmentSkillInstructionModel">
                <Grid BackgroundColor="White">
                    <Grid.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding BindingContext.NavigateToInstructionItems, Source={x:Reference Page}}" CommandParameter="{Binding}" />
                    </Grid.GestureRecognizers>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="160" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--  Background Image  -->
                    <controls:CustomImage
                        Grid.Column="0"
                        Aspect="Fill"
                        ImageUrl="{Binding Picture}" />

                    <!--  Overlay  -->
                    <controls:CustomImage
                        Grid.Column="0"
                        Aspect="Fill"
                        BackgroundColor="LightGray"
                        IsVisible="{Binding IsCompleted}"
                        Opacity="0.8" />

                    <Label
                        Grid.Column="0"
                        Margin="30"
                        FontFamily="{StaticResource MaterialFontFamily}"
                        FontSize="60"
                        HorizontalOptions="CenterAndExpand"
                        IsVisible="{Binding IsCompleted}"
                        Text="{x:Static classes:IconFont.Check}"
                        TextColor="{StaticResource GreenColor}"
                        VerticalOptions="StartAndExpand" />


                    <!--  Assessment Name  -->
                    <Label
                        Grid.Column="1"
                        Margin="20"
                        FontSize="Large"
                        Text="{Binding Name}"
                        TextColor="Black" />
                </Grid>
            </DataTemplate>

            <DataTemplate
                x:Key="GridItemTemplate"
                x:Name="Assessments"
                x:DataType="models:AssessmentSkillInstructionModel">
                <button:SfButton
                    Background="{StaticResource DarkBlueColor}"
                    Command="{Binding BindingContext.NavigateToInstructionItems, Source={x:Reference Page}}"
                    CommandParameter="{Binding}"
                    CornerRadius="0">
                    <button:SfButton.Content>
                        <DataTemplate>
                            <Grid InputTransparent="True">
                                <Grid.RowDefinitions />

                                <!--  Background Image  -->
                                <controls:CustomImage
                                    Aspect="Fill"
                                    ImageUrl="{Binding Picture}"
                                    Opacity="0.2" />

                                <!--  Title & description  -->
                                <ScrollView>
                                    <StackLayout VerticalOptions="EndAndExpand">
                                        <Label
                                            FontFamily="{StaticResource RobotoBold}"
                                            FontSize="Large"
                                            StyleClass="mx-20"
                                            Text="{Binding Name}"
                                            TextColor="White"
                                            VerticalOptions="EndAndExpand" />
                                    </StackLayout>
                                </ScrollView>


                                <!--  Overlay  -->
                                <controls:CustomImage
                                    Aspect="Fill"
                                    BackgroundColor="LightGray"
                                    IsVisible="{Binding IsCompleted}"
                                    Opacity="0.8" />

                                <Label
                                    Margin="30"
                                    FontFamily="{StaticResource MaterialFontFamily}"
                                    FontSize="60"
                                    HorizontalOptions="CenterAndExpand"
                                    IsVisible="{Binding IsCompleted}"
                                    Text="{x:Static classes:IconFont.Check}"
                                    TextColor="{StaticResource GreenColor}"
                                    VerticalOptions="StartAndExpand" />
                            </Grid>
                        </DataTemplate>
                    </button:SfButton.Content>
                </button:SfButton>
            </DataTemplate>

            <DataTemplate x:Key="ParticipantAssessmentsTemplate" x:DataType="models:BasicAssessmentModel">
                <StackLayout
                    Padding="0,5,0,5"
                    BackgroundColor="White"
                    Orientation="Horizontal">
                    <!--  Participant name  -->
                    <Label
                        Grid.Column="0"
                        Margin="15,0,0,0"
                        FontSize="Medium"
                        HorizontalOptions="StartAndExpand"
                        Text="{Binding CompletedFor}"
                        TextColor="Black"
                        VerticalOptions="CenterAndExpand" />

                    <!--  Participant picture  -->
                    <button:SfButton
                        Grid.Column="1"
                        Margin="0,0,10,0"
                        Style="{StaticResource ProfileImageBorder}">
                        <button:SfButton.Content>
                            <DataTemplate>
                                <controls:CustomImage
                                    Aspect="AspectFill"
                                    HorizontalOptions="EndAndExpand"
                                    ImageUrl="{Binding CompletedForPicture}"
                                    Placeholder="profile.png" />
                            </DataTemplate>
                        </button:SfButton.Content>
                    </button:SfButton>
                </StackLayout>
            </DataTemplate>


            <DataTemplate x:Key="SelectedParticipantAssessmentsTemplate" x:DataType="models:BasicAssessmentModel">
                <StackLayout
                    Padding="0,5,0,5"
                    BackgroundColor="{x:StaticResource GreenColor}"
                    Orientation="Horizontal">
                    <!--  Participant name  -->
                    <Label
                        Grid.Column="0"
                        Margin="15,0,0,0"
                        FontSize="Medium"
                        HorizontalOptions="StartAndExpand"
                        Text="{Binding CompletedFor}"
                        TextColor="Black"
                        VerticalOptions="CenterAndExpand" />

                    <!--  Participant picture  -->
                    <button:SfButton
                        Grid.Column="1"
                        Margin="0,0,10,0"
                        Style="{StaticResource ProfileImageBorder}">
                        <button:SfButton.Content>
                            <DataTemplate>
                                <controls:CustomImage
                                    Aspect="AspectFill"
                                    HorizontalOptions="EndAndExpand"
                                    ImageUrl="{Binding CompletedForPicture}"
                                    Placeholder="profile.png" />
                            </DataTemplate>
                        </button:SfButton.Content>
                    </button:SfButton>
                </StackLayout>
            </DataTemplate>


            <DataTemplate x:Key="ParticipantsHeaderTemplate">
                <StackLayout
                    Grid.Column="0"
                    BackgroundColor="White"
                    Orientation="Horizontal">
                    <Label
                        Margin="0,0,5,0"
                        Padding="15,10,0,10"
                        BackgroundColor="White"
                        FontSize="Large"
                        HorizontalOptions="Start"
                        Text="{classes:Translate APP_ASSESSMENTS_PARTICIPANTS}"
                        TextColor="Black"
                        VerticalOptions="EndAndExpand" />
                    <button:SfButton
                        Margin="0,0,20,0"
                        Background="Transparent"
                        Command="{Binding BindingContext.OpenUserPopupCommand, Source={x:Reference Page}}"
                        HorizontalOptions="End"
                        IsEnabled="True"
                        Stroke="Transparent"
                        VerticalOptions="Center"
                        WidthRequest="20">
                        <buttons:SfButton.Content>
                            <DataTemplate>
                                <Label
                                    FontFamily="{StaticResource MaterialFontFamily}"
                                    FontSize="20"
                                    HorizontalOptions="CenterAndExpand"
                                    HorizontalTextAlignment="Center"
                                    Text="{x:Static classes:IconFont.Add}"
                                    TextColor="{x:StaticResource GreenColor}"
                                    VerticalOptions="CenterAndExpand"
                                    VerticalTextAlignment="Center" />
                            </DataTemplate>

                        </buttons:SfButton.Content>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Disabled">
                                    <VisualState.Setters />
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                    </button:SfButton>
                </StackLayout>
            </DataTemplate>

            <DataTemplate x:Key="AssessmentsFooterTemplate" x:DataType="viewModels:AssessmentsViewModel">
                <viewCells:SignButtonTemplate
                    CompleteText="{classes:Translate COMPLETE_ASSESSMENT_BUTTON_TEXT}"
                    IsSignatureRequired="{Binding BindingContext.SelectedUserAssessment.SignatureRequired, Source={x:Reference Page}}"
                    SignCommand="{Binding BindingContext.SignCommand, Source={x:Reference Page}}"
                    SignText="{classes:Translate ASSESSMENT_TASKS_SIGN_TEXT}"
                    TasksDone="{Binding BindingContext.SelectedUserAssessment.IsSignButtonEnabled, Source={x:Reference Page}}"
                    TextHorizontalOption="EndAndExpand" />
            </DataTemplate>

            <DataTemplate x:Key="RightSwipeTemplate" x:DataType="viewModels:AssessmentsViewModel">
                <Grid BackgroundColor="{StaticResource RedColor}">
                    <Label
                        FontFamily="{StaticResource MaterialFontFamily}"
                        FontSize="Large"
                        HorizontalOptions="CenterAndExpand"
                        Text="{x:Static classes:IconFont.Delete}"
                        TextColor="White"
                        VerticalOptions="CenterAndExpand" />
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="AutocompleteTemplate" x:Name="AutocompleteTemplate">
                <StackLayout
                    Padding="20,20,20,0"
                    HorizontalOptions="Fill"
                    VerticalOptions="Start">

                    <!--  Participant Input  -->
                    <inputLayout:SfTextInputLayout
                        ContainerType="Outlined"
                        Hint="{classes:Translate Text={x:Static utils:LanguageConstants.participantName}}"
                        OutlineCornerRadius="5"
                        Stroke="{StaticResource GreenColor}">
                        <inputs:SfAutocomplete
                            DisplayMemberPath="Text"
                            DropDownPlacement="Bottom"
                            HeightRequest="55"
                            IsClearButtonVisible="False"
                            MaxDropDownHeight="150"
                            ItemsSource="{Binding Resources}"
                            Text="{Binding AutoCompleteText, Mode=TwoWay}"
                            TextSearchMode="Contains">
                            <inputs:SfAutocomplete.HeightRequest>
                                <OnPlatform x:TypeArguments="x:Double">
                                    <On Platform="iOS">20</On>
                                    <On Platform="Android,Windows">45</On>
                                </OnPlatform>
                            </inputs:SfAutocomplete.HeightRequest>
                            <inputs:SfAutocomplete.Behaviors>
                                <behaviors:EventToCommandBehavior Command="{Binding AutoCompleteSelectedCommand}" EventName="SelectionChanged" />
                            </inputs:SfAutocomplete.Behaviors>
                        </inputs:SfAutocomplete>
                    </inputLayout:SfTextInputLayout>

                    <ScrollView HeightRequest="200">
                        <StackLayout BindableLayout.ItemsSource="{Binding PopupResources}" VerticalOptions="StartAndExpand">
                            <BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="actionsModels:ResourceModel">
                                    <StackLayout Orientation="Horizontal">
                                        <Label HorizontalOptions="StartAndExpand" Text="{Binding Text}" />
                                        <Label
                                            FontFamily="{StaticResource MaterialFontFamily}"
                                            FontSize="Large"
                                            HorizontalOptions="End"
                                            Text="{x:Static classes:IconFont.Delete}">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding BindingContext.RemoveResourceCommand, Source={x:Reference Page}}" CommandParameter="{Binding}" />
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </StackLayout>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                        </StackLayout>
                    </ScrollView>

                </StackLayout>
            </DataTemplate>

        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Content>
        <AbsoluteLayout AbsoluteLayout.LayoutBounds="0,0,1,1" AbsoluteLayout.LayoutFlags="WidthProportional,HeightProportional">

            <popup:SfPopup
                FooterHeight="80"
                HeaderHeight="45"
                HeaderTitle=""
                IsOpen="{Binding IsDeleteParticipantPopupOpen}"
                MinimumHeightRequest="400"
                ShowFooter="True"
                WidthRequest="500">
                <popup:SfPopup.Behaviors>
                    <behaviors:EventToCommandBehavior Command="{Binding CloseDeleteParticipantPopupCommand}" EventName="Closed" />
                </popup:SfPopup.Behaviors>
                <popup:SfPopup.ContentTemplate>
                    <DataTemplate>
                        <Label
                            Padding="20"
                            FontSize="Large"
                            Text="{classes:Translate Text={x:Static utils:LanguageConstants.deleteParticipantMessage}}" />
                    </DataTemplate>
                </popup:SfPopup.ContentTemplate>
                <popup:SfPopup.FooterTemplate>
                    <DataTemplate>
                        <Grid
                            Padding="20"
                            ColumnSpacing="30"
                            CompressedLayout.IsHeadless="True"
                            HeightRequest="80"
                            HorizontalOptions="Fill"
                            VerticalOptions="End">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.5*" />
                                <ColumnDefinition Width="0.5*" />
                            </Grid.ColumnDefinitions>

                            <!--  Cancel Button  -->
                            <button:SfButton
                                Grid.Column="0"
                                Background="Transparent"
                                Command="{Binding CloseDeleteParticipantPopupCommand}"
                                CornerRadius="5"
                                HorizontalOptions="FillAndExpand"
                                IsEnabled="True"
                                Stroke="{StaticResource RedColor}"
                                StrokeThickness="3"
                                Text="{classes:Translate BASE_TEXT_CANCEL}"
                                TextColor="{StaticResource RedColor}" />
                            <!--  Add Button  -->
                            <customButtons:SubmitButton
                                Grid.Column="1"
                                ButtonText="{classes:Translate BASE_TEXT_OK}"
                                Command="{Binding SubmitDeleteParticipantPopupCommand}"
                                HorizontalOptions="FillAndExpand"
                                IsLoading="{Binding IsBusy}" />
                        </Grid>
                    </DataTemplate>
                </popup:SfPopup.FooterTemplate>
            </popup:SfPopup>

            <popup:SfPopup
                x:Name="PopupLayout"
                x:DataType="viewModels:AssessmentsViewModel"
                ContentTemplate="{StaticResource AutocompleteTemplate}"
                ShowCloseButton="True"
                FooterHeight="80"
                HeaderHeight="45"
                IsOpen="{Binding IsUserPopupOpen}"
                MinimumHeightRequest="400"
                Opened="PopupLayout_Opened"
                ShowFooter="True"
                StaysOpen="True"
                WidthRequest="500">
                <popup:SfPopup.Behaviors>
                    <behaviors:EventToCommandBehavior Command="{Binding CloseUserPopupCommand}" EventName="Closed" />
                </popup:SfPopup.Behaviors>
                <!--  Add Participant Header  -->
                <popup:SfPopup.HeaderTemplate>
                    <DataTemplate>
                        <StackLayout Padding="20,20,20,0">
                            <Label
                                FontFamily="{StaticResource RobotoRegular}"
                                FontSize="Medium"
                                HorizontalTextAlignment="Start"
                                Text="{classes:Translate Text={x:Static utils:LanguageConstants.addParticipant}}"
                                VerticalTextAlignment="Start" />
                        </StackLayout>
                    </DataTemplate>
                </popup:SfPopup.HeaderTemplate>
                <popup:SfPopup.FooterTemplate>
                    <DataTemplate>
                        <Grid
                            Padding="20"
                            ColumnSpacing="30"
                            HeightRequest="80"
                            HorizontalOptions="FillAndExpand"
                            VerticalOptions="EndAndExpand">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.5*" />
                                <ColumnDefinition Width="0.5*" />
                            </Grid.ColumnDefinitions>
                            <!--  Cancel Button  -->
                            <button:SfButton
                                Grid.Column="0"
                                Background="Transparent"
                                Command="{Binding CloseUserPopupCommand}"
                                CornerRadius="0"
                                HorizontalOptions="FillAndExpand"
                                Stroke="{StaticResource RedColor}"
                                StrokeThickness="3"
                                Text="{classes:Translate BASE_TEXT_CANCEL}"
                                TextColor="{StaticResource RedColor}" />
                            <!--  Add Button  -->
                            <customButtons:SubmitMauiButton
                                Grid.Column="1"
                                HeightRequest="40"
                                ButtonText="{classes:Translate BASE_TEXT_ADD}"
                                Clicked="{Binding SubmitUserPopupCommand}"
                                HorizontalOptions="FillAndExpand"
                                IsLoading="{Binding IsBusy}" />
                        </Grid>
                    </DataTemplate>
                </popup:SfPopup.FooterTemplate>


            </popup:SfPopup>

            <Grid
                AbsoluteLayout.LayoutBounds="0,0,1,1"
                AbsoluteLayout.LayoutFlags="WidthProportional,HeightProportional"
                ColumnSpacing="0"
                CompressedLayout.IsHeadless="True"
                RowSpacing="0">
                <Grid.RowDefinitions>
                    <!--  AppBar Row  -->
                    <RowDefinition Height="0.127*" />
                    <!--  Content Row  -->
                    <RowDefinition />
                </Grid.RowDefinitions>

                <!--  App Bar  -->
                <Grid Grid.Row="0" Style="{StaticResource HeaderStyle}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="0.7*" />
                        <ColumnDefinition Width="0.35*" />
                    </Grid.ColumnDefinitions>

                    <!--  Title Label  -->
                    <Label
                        Grid.Column="1"
                        FontFamily="{StaticResource RobotoLight}"
                        HorizontalOptions="Start"
                        StyleClass="title, fs-large, fc-darkgrey"
                        Text="{Binding AssessmentsTemplateFilter.SelectedFilter.Name}"
                        VerticalOptions="CenterAndExpand" />

                    <!--  Statuses && List Switcher Controls  -->
                    <StackLayout Grid.Column="2" Orientation="Horizontal">

                        <!--  Info Label  -->
                        <StackLayout
                            Grid.Column="0"
                            Margin="10"
                            HorizontalOptions="End"
                            VerticalOptions="Center"
                            WidthRequest="200">
                            <Label
                                Margin="10,0,0,0"
                                FontSize="12"
                                HorizontalOptions="EndAndExpand"
                                Text="{Binding CompletedInstructionsText}" />
                            <Label
                                Margin="10,0,0,0"
                                FontSize="12"
                                HorizontalOptions="EndAndExpand"
                                Text="{Binding AllInstructionsText}" />
                        </StackLayout>

                        <StackLayout
                            Grid.Column="1"
                            Padding="0,0,15,0"
                            HorizontalOptions="EndAndExpand"
                            StyleClass="column2"
                            VerticalOptions="Center">
                            <!--  Layout Switch Buttons  -->
                            <controls:LayoutSwitcher
                                HorizontalOptions="EndAndExpand"
                                ListLayout="{Binding ListViewLayout}"
                                TapCommand="{Binding ListViewLayoutCommand}"
                                VerticalOptions="End" />
                        </StackLayout>
                    </StackLayout>
                </Grid>

                <!--  Content  -->
                <Grid
                    Grid.Row="1"
                    x:DataType="viewModels:AssessmentsViewModel"
                    BackgroundColor="{x:StaticResource BackgroundColor}"
                    ColumnSpacing="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="MenuColumn" Width="0.098*" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!--  Side menu  -->
                    <partial:MenuNewControl
                        Grid.Row="0"
                        Grid.RowSpan="2"
                        Grid.Column="0"
                        StyleClass="bg-darkblue, fc-white" />

                    <!--  Tags and description container  -->
                    <StackLayout
                        Grid.Row="0"
                        Grid.Column="1"
                        BackgroundColor="White"
                        Orientation="Vertical">
                        <!--  Description  -->
                        <ScrollView HeightRequest="70" IsVisible="{Binding SelectedAssessmentTemplate.Description, Converter={StaticResource StringIsNullOrEmptyConverter}, ConverterParameter=False}">
                            <Label Margin="20,0,0,10" VerticalTextAlignment="Center">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span FontFamily="{StaticResource RobotoBold}" Text="{classes:Translate Text={x:Static utils:LanguageConstants.generalTextDescription}}" />
                                        <Span FontFamily="{StaticResource RobotoBold}" Text=": " />
                                        <Span FontFamily="{StaticResource RobotoLight}" Text="{Binding SelectedAssessmentTemplate.Description}" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </ScrollView>

                        <!--  Tag list  -->
                        <ScrollView
                            HeightRequest="100"
                            IsVisible="{Binding ContainsTags}"
                            Orientation="Horizontal">
                            <controls:TagList
                                Margin="20,0,0,0"
                                BindableLayout.ItemsSource="{Binding SelectedAssessmentTemplate.Tags}"
                                Wrap="NoWrap" />
                        </ScrollView>

                    </StackLayout>


                    <Grid
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="20,20,10,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition x:Name="UsersColumn" Width="0.35*" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <!--  Participants column  -->
                        <pulltorefresh:SfPullToRefresh
                            Grid.Column="0"
                            BackgroundColor="{StaticResource BackgroundColor}"
                            IsRefreshing="{Binding IsRefreshing}"
                            ProgressColor="#0003E8"
                            PullingThreshold="100"
                            RefreshCommand="{Binding RefreshCommand}"
                            RefreshViewHeight="30"
                            RefreshViewThreshold="30"
                            RefreshViewWidth="30">

                            <pulltorefresh:SfPullToRefresh.PullableContent>
                                <sf:SfListView
                                    x:Name="ParticipantsListView"
                                    Grid.Column="0"
                                    AllowSwiping="True"
                                    AutoFitMode="DynamicHeight"
                                    CachingStrategy="CreateNewTemplate"
                                    EndSwipeTemplate="{StaticResource RightSwipeTemplate}"
                                    HeaderSize="60"
                                    HeaderTemplate="{StaticResource ParticipantsHeaderTemplate}"
                                    ItemSpacing="1"
                                    ItemTemplate="{StaticResource ParticipantAssessmentsTemplate}"
                                    ItemsSource="{Binding Assessments}"
                                    SelectedItem="{Binding SelectedUserAssessment, Mode=TwoWay}"
                                    SelectedItemTemplate="{StaticResource SelectedParticipantAssessmentsTemplate}"
                                    SelectionMode="Single"
                                    SwipeOffset="100"
                                    SwipeThreshold="60"
                                    TapCommand="{Binding ShowUserAssessment}">

                                    <sf:SfListView.DataSource>
                                        <data:DataSource>
                                            <data:DataSource.SortDescriptors>
                                                <data:SortDescriptor Direction="Descending" PropertyName="Id" />
                                            </data:DataSource.SortDescriptors>
                                        </data:DataSource>
                                    </sf:SfListView.DataSource>

                                    <sf:SfListView.Behaviors>
                                        <behaviors:EventToCommandBehavior Command="{Binding OpenDeleteParticipantPopupCommand}" EventName="Swiping" />
                                    </sf:SfListView.Behaviors>
                                </sf:SfListView>
                            </pulltorefresh:SfPullToRefresh.PullableContent>
                        </pulltorefresh:SfPullToRefresh>


                        <!--  User assessments column  -->
                        <!-- <Grid Grid.Column="1"> -->
                        <!--  Detail Page  -->
                        <!-- <list:PullToRefreshList
                                x:TypeArguments="viewModels:AssessmentsViewModel"
                                BackgroundColor="White"
                                FooterSize="100"
                                FooterTemplate="{StaticResource AssessmentsFooterTemplate}"
                                GridItemTemplate="{StaticResource GridItemTemplate}"
                                HasItems="{Binding UserSkillInstructionsFilter.HasItems}"
                                IsRefreshing="{Binding IsRefreshing}"
                                LinearItemTemplate="{StaticResource LinearItemTemplate}"
                                ListDataSource="{Binding UserSkillInstructionsFilter.ListSource}"
                                ListItemSize="{Binding LayoutManager.CurrentLayout.ItemSize}"
                                ListItemSpacing="{Binding LayoutManager.CurrentLayout.ItemSpacing}"
                                ListItemsSource="{Binding UserSkillInstructionsFilter.FilteredList}"
                                ListViewLayout="{Binding LayoutManager.ListLayout}"
                                RefreshCommand="{Binding RefreshCommand}"
                                SpanCount="{Binding LayoutManager.CurrentLayout.SpanCount}" />-->
                        <!-- </Grid> -->

                        <!--  Detail page  -->
                        <pulltorefresh:SfPullToRefresh
                            Grid.Column="1"
                            IsRefreshing="{Binding IsRefreshing}"
                            ProgressColor="#0003E8"
                            PullingThreshold="100"
                            RefreshCommand="{Binding RefreshCommand}"
                            RefreshViewHeight="30"
                            RefreshViewThreshold="30"
                            RefreshViewWidth="30">
                            <pulltorefresh:SfPullToRefresh.PullableContent>
                                <Grid>
                                    <listview:SfListView
                                        x:Name="gridListView"
                                        Background="White"
                                        FooterSize="100"
                                        FooterTemplate="{StaticResource AssessmentsFooterTemplate}"
                                        IsVisible="{Binding IsListVisible, Converter={StaticResource ReverseBooleanConverter}}"
                                        ItemSize="200"
                                        ItemSpacing="5"
                                        ItemTemplate="{StaticResource GridItemTemplate}"
                                        ItemsSource="{Binding UserSkillInstructionsFilter.FilteredList}"
                                        SelectionMode="None">
                                        <listview:SfListView.ItemsLayout>
                                            <listview:GridLayout SpanCount="3" />
                                        </listview:SfListView.ItemsLayout>
                                    </listview:SfListView>

                                    <listview:SfListView
                                        x:Name="linearListView"
                                        Background="White"
                                        FooterSize="100"
                                        FooterTemplate="{StaticResource AssessmentsFooterTemplate}"
                                        IsVisible="{Binding IsListVisible}"
                                        ItemSize="110"
                                        ItemSpacing="7"
                                        ItemTemplate="{StaticResource LinearItemTemplate}"
                                        ItemsSource="{Binding UserSkillInstructionsFilter.FilteredList}"
                                        SelectionMode="None" />


                                    <controls:EmptyView IsVisible="{Binding UserSkillInstructionsFilter.HasItems, Converter={StaticResource ReverseBooleanConverter}}" />

                                </Grid>
                            </pulltorefresh:SfPullToRefresh.PullableContent>
                        </pulltorefresh:SfPullToRefresh>
                    </Grid>
                    <!--  Message Center  -->
                    <controls:MessageCenter Grid.Column="1" />
                </Grid>
            </Grid>


        </AbsoluteLayout>
    </ContentPage.Content>
</ContentPage>
