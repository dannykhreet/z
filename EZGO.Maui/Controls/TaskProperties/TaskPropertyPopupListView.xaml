<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="EZGO.Maui.Controls.TaskProperties.TaskPropertyPopupListView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:behaviors="clr-namespace:EZGO.Maui.Behaviors"
    xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:local="clr-namespace:EZGO.Maui.Controls.TaskProperties"
    xmlns:sfList="clr-namespace:Syncfusion.Maui.ListView;assembly=Syncfusion.Maui.ListView"
    xmlns:tasks="clr-namespace:EZGO.Maui.Core.Models.Tasks;assembly=EZGO.Maui.Core"
    x:Name="control">
    <ContentView.Resources>
        <ResourceDictionary>

            <DataTemplate x:Key="emptyTemplate" x:DataType="tasks:BasicTaskPropertyModel">
                <BoxView BackgroundColor="{StaticResource GreyColor}" Opacity="0.2" />
            </DataTemplate>

            <DataTemplate x:Key="propertyTemplate" x:DataType="tasks:BasicTaskPropertyModel">

                <buttons:SfButton
                    CornerRadius="0"
                    Background="{Binding DisplayType, Converter={StaticResource StatusToColorConverter}}"
                    Command="{Binding OpenPopupCommand, Source={x:Reference control}}"
                    CommandParameter="{Binding}"
                    IsVisible="{Binding Converter={StaticResource IsNullConverter}, ConverterParameter=False}">
                    <buttons:SfButton.Content>
                        <DataTemplate>
                            <Border Stroke="Transparent" StrokeThickness="5">
                                <!--  Border Triggers  -->
                                <Border.Triggers>
                                    <!--  Selected Trigger  -->
                                    <DataTrigger
                                        Binding="{Binding IsValid}"
                                        TargetType="Border"
                                        Value="False">
                                        <Setter Property="Stroke" Value="{StaticResource RedColor}" />
                                    </DataTrigger>
                                    <!--  Unselected Trigger  -->
                                    <DataTrigger
                                        Binding="{Binding IsValid}"
                                        TargetType="Border"
                                        Value="True">
                                        <Setter Property="Stroke" Value="Transparent" />
                                    </DataTrigger>
                                </Border.Triggers>
                                <local:BasicTaskPropertyStackLayout />
                            </Border>
                        </DataTemplate>
                    </buttons:SfButton.Content>
                </buttons:SfButton>
            </DataTemplate>

            <local:TaskPropertyPopupListViewItemTemplateSelector
                x:Key="templateSelector"
                EmptyDataTemplate="{StaticResource emptyTemplate}"
                PropertyDataTemplate="{StaticResource propertyTemplate}" />
        </ResourceDictionary>
    </ContentView.Resources>
    <ContentView.Content>

        <sfList:SfListView
            x:Name="listView"
            Padding="0,0,1,0"
            Background="{StaticResource BackgroundColor}"
            ItemSpacing="0, 0, 0, 2"
            IsScrollingEnabled="False"
            ItemTemplate="{StaticResource templateSelector}"
            Orientation="Vertical">
            <sfList:SfListView.Behaviors>
                <behaviors:AutomaticItemSizeListViewBehavior NumberOfItems="{x:Static local:TaskPropertyPopupListView.NumberOfItemsVisible}" />
            </sfList:SfListView.Behaviors>

        </sfList:SfListView>

    </ContentView.Content>
</ContentView>
